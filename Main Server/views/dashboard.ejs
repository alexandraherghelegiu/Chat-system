<!DOCTYPE html>
<html>
<head>
    <script src="/socket.io/socket.io.js"></script>
    <link rel='stylesheet' href='/stylesheets/style.css'/>
    <link rel='stylesheet' href="/stylesheets/bootstrap.css"/>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="/javascripts/bootstrap.bundle.js"></script>
    <script src="/javascripts/dashboard.js"></script>
    <script type="module" src="/javascripts/indexed_database.js"></script>
    <script src="/javascripts/canvas.js"></script>
    <script src="/javascripts/camera.js"></script>
    <script src="/javascripts/ajax.js"></script>
</head>
<body onload="init()">
    <div id="initial_form" style="display: block">
        <h1>Welcome, <%= name %> !</h1>
        <p>Please insert the id of the Room you want to Join, if you do not have a room id, click Generate Room</p>

        <div class="row">
            <div class="col">
                <!--  Checkbox  -->
                <div id="checkboxContainer">
                    <input type="checkbox" id="box-1" onclick="toggleFormFields()">
                    <label for="box-1" class="form-label">Joining an existing room</label>
                </div>
                <!--    Create/join room form    -->
                <form id="enter-join-form" onsubmit="return false;">
                    <label for="roomNo" class="form-label"> Your room </label>
                    <div class="row mb-3">
                        <div class="col">
                            <input type="text" id="roomNo" name="roomid" class="form-control">
                        </div>
                        <div class="col-auto">
                            <button id="roomNoGenerator" onclick="generateRoom()" class="btn btn-secondary">Generate Room</button>
                        </div>
                    </div>
                    <label for="image_url" class="form-label"> Image (URL) </label>
                    <div class="row mb-3">
                        <div class="col">
                            <input type="text" id="image_url" name="imageUrl" class="form-control">
                        </div>
                        <div class="col-auto">
                            <input id="img_upload" type="file" accept="image/jpeg, image/png" onchange="uploadImg(img_upload.files[0], 'image_url')" style="display: none;">
                            <button onclick="document.getElementById('img_upload').click()" class="btn btn-secondary">Upload</button>
                        </div>
                        <div class="col-auto">
                            <button id="takePicture" data-toggle="modal" data-target="#cameraModal" onclick="setupCamera(false)" class="btn btn-secondary">Take Picture</button>
                        </div>
                        <div class="col-auto">
                            <button id="pickImage" data-toggle="modal" data-target="#imageSelectorModal" onclick="" class="btn btn-secondary">Select from uploaded images</button>
                        </div>
                    </div>

                    <!-- Image title -->
                    <div class="mb-3">
                        <label class="form-label">Image title</label>
                        <input id="img_title" name="imageTitle" class="form-control">
                    </div>

                    <!-- Image description -->
                    <div class="mb-3">
                        <label class="form-label">Image description</label>
                        <textarea id="img_description" name="imageDesc" class="form-control" aria-label="Image description"></textarea>
                    </div>


                    <button id="connect" onclick="sendFormData('enter-join-form')" class="btn btn-primary">Connect</button>
                </form>
            </div>
        </div>



        <!--   Filter     -->
        <div id="filter-input-group">
            <label class="form-label">Filter:</label>
            <input class="form-control" id="authorFilter" name="authorFilter" onkeyup="filterTiles(authorFilter.value)">
        </div>

        <!--   Room tiles     -->
        <div id="roomTileList" class="row">
        </div>
    </div>

    <!-- #####################CHAT INTERFACE#################### -->
    <div id="chat_interface" style="display: none;">
        <div>
            <div id="who_you_are" style="display: inline" style="height: 10vh"> <%= name %></div>, you are in room: <div id="in_room" style="display: inline"></div>
            <button id="leave_room" onclick="disconnectFromRoom()" class="btn btn-primary">Leave Room</button>
        </div>


        <div class="container" >
            <div class="row d-flex align-items-stretch">

                <div class="column flex-fill flex-column">
                    <img id="image" style="width: 33%;">
                    <canvas id="canvas"></canvas><br>
                    <div class="row" style="display: inline-flex">
                        <div id='pink-box' class="col-xs-6 col-sm-4 col-md-2 pink square"></div>
                        <div id='blue-box' class="col-xs-6 col-sm-4 col-md-2 blue square"></div>
                        <div id='red-box' class="col-xs-6 col-sm-4 col-md-2 red square"></div>
                        <div id='orange-box' class="col-xs-6 col-sm-4 col-md-2 orange square"></div>
                        <div id='green-box' class="col-xs-6 col-sm-4 col-md-2 green square"></div>
                        <div id='white-box' class="col-xs-6 col-sm-4 col-md-2 white square border"></div>
                        <div id='black-box' class="col-xs-6 col-sm-4 col-md-2 black square"></div>
                        <div id='yellow-box' class="col-xs-6 col-sm-4 col-md-2 yellow square"></div>

                    </div>

                    <br>
                    <button id="download_button" onclick="downloadDrawing()" class="btn btn-secondary">Download</button>
                    <button id="canvas-clear" class="btn btn-secondary">Clear Canvas</button>
                    <br>
                    <div class="dropdown" >
                        <button class="btn btn-secondary dropdown-toggle" type="button" id="create-room-dropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" onclick="fillRoomNo(roomNoDD)">Create room link</button>
                        <div class="dropdown-menu">
                            <form id="dropdown-create-room" class="px-4 py-3" onsubmit="return false;">
                                <div class="form-group">
                                    <label for="roomNoDD">Room Name</label>
                                    <input type="text" class="form-control" id="roomNoDD" name="roomid" readonly>
                                </div>
                                <div class="form-group">
                                    <label for="new_image_url">Image Url</label>
                                    <input type="text" class="form-control mb-3" id="new_image_url" name="imageUrl">
                                    <div class="row">
                                        <div class="col-auto">
                                            <button id="takePictureSmall" data-toggle="modal" data-target="#cameraModal" onclick="setupCamera(true)" class="btn btn-secondary">Take Picture</button>
                                        </div>
                                        <div class="col">
                                            <input id="img_upload_small" type="file" accept="image/jpeg, image/png" onchange="uploadImg(img_upload_small.files[0], 'new_image_url')" style="display: none;">
                                            <button onclick="document.getElementById('img_upload_small').click()" class="btn btn-secondary">Upload</button>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="new_img_title">Image Title</label>
                                    <input type="text" class="form-control" id="new_img_title" name="imageTitle">
                                </div>
                                <div class="form-group">
                                    <label for="new_img_title">Image Description</label>
                                    <textarea type="text" class="form-control" id="new_img_desc" name="imageDesc"></textarea>
                                </div>
                                <button id="create_room_link" onclick="generateRoomLink('dropdown-create-room')" class="btn btn-primary">Generate room link</button>
                            </form>

                        </div>
                    </div>
                </div>
                <!--    </div>-->
                <div class="column flex-fill flex-column w-50%">
                    <div id="history" class="boxed scrolling " ></div>
                    <div id="input" class=" boxed bottom">
                        <form onsubmit="return false;" style="width: 100%">
                            <p>
                                <label for="name"> chat: </label>
                                <input type="text" id="chat_input" name="chat_input" >
                                <button id="chat_send" onclick="sendChatText(chat_input.value)" class="btn btn-primary">Send</button>

                            </p>
                        </form>
                    </div>
                </div>

            </div>

        </div>



    </div>

    <!-- ######################MODALS############################ -->

    <!--  Camera Modal  -->
    <div class="modal fade" id="cameraModal" tabindex="-1" role="dialog" aria-labelledby="cameraModalCenterTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="cameraModalLongTitle">Camera</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close" onclick="closeCamera()">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <!-- DIV CAMERA -->
                    <div id="cameraInterface" style="display: none" class="mb-3">
                        <!-- Camera -->
                        <div class="camera" >
                            <video id="video">Video stream not available.</video>
                            <!-- Buttons -->
                        </div>

                        <!-- Preview -->
                        <div id="previewGroup" style="display: none;">
                            <canvas id="preview"></canvas>
                            <div id="output">
                                <img id="photoTaken" alt="photo will appear here">
                            </div>

                        </div>
                    </div>
                </div>
                <!-- Buttons -->
                <div class="modal-footer">
                    <button id="shutter" class="btn btn-primary">Take photo</button>

                    <!--                                <div class="col">-->
                    <button id="confirm" style="display: none" onclick="uploadTakenImage('image_url')" data-dismiss="modal" class="btn btn-primary">Confirm</button>
                    <button id="confirmSmall" style="display: none" onclick="uploadTakenImage('new_image_url')" data-dismiss="modal" class="btn btn-primary">Confirm</button>
                    <!--                                </div>-->
                    <!--                                <div class="col text-right">-->
                    <button id="retake" style="display: none" class="btn btn-secondary">Retake</button>
                    <!--                                </div>-->
                </div>
            </div>
        </div>
    </div>

    <!--  Image Selector Modal  -->
    <div class="modal fade" id="imageSelectorModal" tabindex="-1" role="dialog" aria-labelledby="imageSelectorModalCenterTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="imageSelectorModalLongTitle">Image Selector</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">

                </div>
                <!-- Buttons -->
                <div class="modal-footer">
                    <button id="selectImage" class="btn btn-primary">Select image</button>
                </div>
            </div>
        </div>
    </div>

</body>
</html>
